
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>LiF tutorial - From ground state DFT to excited state MBPT via Wannerization methods &#8212; QuREX Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/tutorials/LiF-tutorial-RR';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">QuREX Documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    QuREX Theoretical Formalism
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../theory/theoretical_background.html">Theoretical Background</a></li>



</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../software/software.html">Software</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../software/yambo/yambo.html">Yambo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/yambo/yambo_input_flags.html">Yambo Input variables</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorials.html">Workflows</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="exciton_phonon.html">Exciton-Phonon</a></li>

</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Notebooks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/notebooks.html">Notebooks Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/exciton_phonon.html"><span class="xref myst">Exciton-Phonon Tutorial</span></a></li>


</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/tutorials/LiF-tutorial-RR.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>LiF tutorial - From ground state DFT to excited state MBPT via Wannerization methods</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">LiF tutorial - From ground state DFT to excited state MBPT via Wannerization methods</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-analysis-with-yambo">Advanced analysis with Yambo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tools-and-libraries">Tools and libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computational-details">Computational details</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crystal-structure-lif">Crystal structure LiF</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dft">DFT</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#self-consistent-field-calculation">self-consistent field calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-self-consistent-calculation">non-self-consistent calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#band-structure">Band structure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wannierization">Wannierization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#excited-state-yambo">Excited state - YAMBO</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conversion-to-yambo-format">Conversion to Yambo format</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialization">Initialization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-phase-approximation">Random-Phase approximation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adiabatic-lda-alda-approximation">Adiabatic LDA (ALDA) approximation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-statically-screened-electron-electron-interaction">The Statically screened Electron-electron interaction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-bse-equation-excitons">The BSE equation, Excitons</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shifted-vs-unshifted-grid">shifted vs unshifted grid</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exciton-band-structure">Exciton band structure</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exciton-band-structure-singlets-vs-triplets">Exciton band structure: singlets vs triplets</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#useful-link">Useful Link</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tb-wannier">TB-wannier</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#bibliography">Bibliography</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="lif-tutorial-from-ground-state-dft-to-excited-state-mbpt-via-wannerization-methods">
<h1>LiF tutorial - From ground state DFT to excited state MBPT via Wannerization methods<a class="headerlink" href="#lif-tutorial-from-ground-state-dft-to-excited-state-mbpt-via-wannerization-methods" title="Link to this heading">#</a></h1>
<p>This tutorial guides you through calculating the electronic ground state properties of Lithium Fluoride (LiF) using Density Functional Theory (DFT)<a class="footnote-reference brackets" href="#id11" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. For our simulations, we’ll be utilizing the Quantum Espresso code package<a class="footnote-reference brackets" href="#id12" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>. We’ll further enhance the electronic band structure analysis by employing a Wannierization procedure<a class="footnote-reference brackets" href="#id13" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> via Fourier interpolation. This step aims to increase the sampling grid while minimizing computational expenses.</p>
<section id="advanced-analysis-with-yambo">
<h2>Advanced analysis with Yambo<a class="headerlink" href="#advanced-analysis-with-yambo" title="Link to this heading">#</a></h2>
<p>Upon establishing the ground state properties, our attention shifts to excited state phenomena using Yambo<a class="footnote-reference brackets" href="#id14" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a><a class="footnote-reference brackets" href="#id15" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>. Our focus here extends to assessing the absorption spectra and delineating the exciton band structure. The Wannierization procedure applied to the excitonic Hamiltonian mirrors that of the electronic scenario, providing a basis for comparison with existing literature findings<a class="footnote-reference brackets" href="#id16" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.</p>
</section>
<section id="tools-and-libraries">
<h2>Tools and libraries<a class="headerlink" href="#tools-and-libraries" title="Link to this heading">#</a></h2>
<p>For the effective pre- and post-processing of our data, we rely on <a class="reference external" href="https://github.com/rreho/yambopy/tree/devel-tbwannier">yambopy</a>, a robust tool available at yambopy GitHub repository. The specific branch <code class="docutils literal notranslate"><span class="pre">devel-tbwannier</span></code> is dedicated to the input/output (IO) and interpolation tasks related to both the electronic and excitonic Hamiltonians.</p>
</section>
<section id="computational-details">
<h2>Computational details<a class="headerlink" href="#computational-details" title="Link to this heading">#</a></h2>
<p>All simulations within this tutorial adhere to the use of LDA pseudopotentials, intentionally excluding Spin-Orbit coupling (SOC) to streamline our computational approach.</p>
</section>
<section id="crystal-structure-lif">
<h2>Crystal structure LiF<a class="headerlink" href="#crystal-structure-lif" title="Link to this heading">#</a></h2>
<p>Lithium Fluoride (LiF) is an insualtor with a wide band-gap and the following characteristics:</p>
<ul class="simple">
<li><p>FCC lattice with 48 symmetry operations</p></li>
<li><p>Two atoms per cell, Li and F (8 electrons)</p></li>
<li><p>Lattice constant 7.61 [a.u.]</p></li>
<li><p>Plane waves cutoff 80 Ry</p></li>
</ul>
<p>For the Yambo analysis we will see that any independent particle approximation drastically fails to describe the complex absorption structures that are observed experimentally.
Indeed, the spectrum of bulk LiF is dominated by a strongly bound exciton (3 eV binding energy)</p>
<div style="text-align: center;">
    <img src="https://hackmd.io/_uploads/BJrSA7ZxA.png" alt="LiF" width="70%">
</div>
</section>
<section id="dft">
<h2>DFT<a class="headerlink" href="#dft" title="Link to this heading">#</a></h2>
<p>This step is foundational, setting the stage for all subsequent analyses by establishing a precise understanding of the system’s electronic distribution.</p>
<section id="self-consistent-field-calculation">
<h3>self-consistent field calculation<a class="headerlink" href="#self-consistent-field-calculation" title="Link to this heading">#</a></h3>
<p>The initial step involves calculating the electronic charge density, occupation, Fermi level, and so on. This is achieved through a self-consistent field (SCF) calculation on the auxiliary Kohn-Sham system.</p>
<ol class="arabic simple">
<li><p>Create an input file <code class="docutils literal notranslate"><span class="pre">scf.in</span></code>:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="p">&amp;</span>control
<span class="w">    </span><span class="nv">calculation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;scf&#39;</span>,
<span class="w">    </span><span class="nv">verbosity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span>
<span class="w">    </span><span class="nv">pseudo_dir</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../psps/&quot;</span>,
<span class="w">    </span><span class="nv">outdir</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;.&quot;</span>,
<span class="w">    </span><span class="nv">wf_collect</span><span class="o">=</span>.TRUE.,
<span class="w">    </span><span class="nv">prefix</span><span class="o">=</span><span class="s1">&#39;LiF&#39;</span>,
<span class="w"> </span>/
<span class="w"> </span><span class="p">&amp;</span>system
<span class="w">    </span><span class="nv">ibrav</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>,<span class="w"> </span><span class="nv">nat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>,<span class="w"> </span><span class="nv">ntyp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>,
<span class="w">    </span><span class="nv">force_symmorphic</span><span class="o">=</span>.TRUE.<span class="w"> </span>,
<span class="w">    </span><span class="nv">ecutwfc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80</span>.0,
<span class="w">    </span><span class="nv">nbnd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="w"> </span>,
<span class="w">    </span>celldm<span class="o">(</span><span class="m">1</span><span class="o">)=</span><span class="m">7</span>.703476,
<span class="w"> </span>/
<span class="w"> </span><span class="p">&amp;</span>electrons
<span class="w">    </span><span class="nv">diago_full_acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.TRUE.,
<span class="w">    </span><span class="nv">conv_thr</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="m">1</span>.0d-10
<span class="w"> </span>/
<span class="w"> </span>ATOMIC_SPECIES
<span class="w">    </span>Li<span class="w">    </span><span class="m">6</span>.941<span class="w">       </span>Li.LDA.cpi.UPF
<span class="w">     </span>F<span class="w">    </span><span class="m">18</span>.998403<span class="w">   </span>F.LDA.cpi.UPF
<span class="w"> </span>ATOMIC_POSITIONS<span class="w"> </span>crystal
Li<span class="w">  </span><span class="m">0</span>.<span class="w"> </span><span class="m">0</span>.<span class="w"> </span><span class="m">0</span>.
<span class="w"> </span>F<span class="w">  </span><span class="m">0</span>.5<span class="w"> </span>-0.5<span class="w"> </span>-0.5
K_POINTS<span class="w"> </span>automatic
<span class="w"> </span><span class="m">4</span><span class="w">  </span><span class="m">4</span><span class="w">  </span><span class="m">4</span><span class="w">  </span><span class="m">0</span><span class="w">  </span><span class="m">0</span><span class="w">  </span><span class="m">0</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>run with:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="mi">4</span> <span class="n">pw</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">scf</span><span class="o">.</span><span class="ow">in</span> <span class="o">|</span><span class="n">tee</span> <span class="n">log_scf</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
</section>
<section id="non-self-consistent-calculation">
<h3>non-self-consistent calculation<a class="headerlink" href="#non-self-consistent-calculation" title="Link to this heading">#</a></h3>
<p>A <strong>non-self-consistent calculation (nscf)</strong> generate a set of Kohn-Sham eigenvalues and eigenvectors for both occupied and unoccupied bands. The output of this calculation are needed for generating the Yambo databases accurately.</p>
<ol class="arabic simple">
<li><p>Create and go in a new directory <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">mkdir</span> <span class="pre">nscf</span></code></p></li>
<li><p>Copy the <code class="docutils literal notranslate"><span class="pre">.save</span></code> folder from the previous <code class="docutils literal notranslate"><span class="pre">scf</span></code> run <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cp</span> <span class="pre">-r</span> <span class="pre">../scf/LiF.save</span> <span class="pre">.</span></code></p></li>
<li><p>Create an <code class="docutils literal notranslate"><span class="pre">nscf.in</span></code> input file:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="p">&amp;</span>control
<span class="w">    </span><span class="nv">calculation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;nscf&#39;</span>,
<span class="w">    </span><span class="nv">verbosity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span>
<span class="w">    </span><span class="nv">pseudo_dir</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;../psps&quot;</span>
<span class="w">    </span><span class="nv">outdir</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;.&quot;</span>
<span class="w">    </span><span class="nv">wf_collect</span><span class="o">=</span>.TRUE.,
<span class="w">    </span><span class="nv">prefix</span><span class="o">=</span><span class="s1">&#39;LiF&#39;</span>,
<span class="w"> </span>/
<span class="w"> </span><span class="p">&amp;</span>system
<span class="w">    </span><span class="nv">ibrav</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>,<span class="w"> </span><span class="nv">nat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>,<span class="w"> </span><span class="nv">ntyp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>,
<span class="w">    </span><span class="nv">force_symmorphic</span><span class="o">=</span>.TRUE.<span class="w"> </span>,
<span class="w">    </span><span class="nv">ecutwfc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">80</span>.0,
<span class="w">    </span><span class="nv">nbnd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="w"> </span>,
<span class="w">    </span>celldm<span class="o">(</span><span class="m">1</span><span class="o">)=</span><span class="m">7</span>.703476,
<span class="w"> </span>/
<span class="w"> </span><span class="p">&amp;</span>electrons
<span class="w">    </span><span class="nv">diago_full_acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.TRUE.,
<span class="w">    </span><span class="nv">conv_thr</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="m">1</span>.0d-10
<span class="w"> </span>/
<span class="w"> </span>ATOMIC_SPECIES
<span class="w">    </span>Li<span class="w">    </span><span class="m">6</span>.941<span class="w">       </span>Li.LDA.cpi.UPF
<span class="w">     </span>F<span class="w">    </span><span class="m">18</span>.998403<span class="w">   </span>F.LDA.cpi.UPF
<span class="w"> </span>ATOMIC_POSITIONS<span class="w"> </span>crystal
Li<span class="w">  </span><span class="m">0</span>.<span class="w"> </span><span class="m">0</span>.<span class="w"> </span><span class="m">0</span>.
<span class="w"> </span>F<span class="w">  </span><span class="m">0</span>.5<span class="w"> </span>-0.5<span class="w"> </span>-0.5
K_POINTS<span class="w"> </span>automatic
<span class="w"> </span><span class="m">4</span><span class="w">  </span><span class="m">4</span><span class="w">  </span><span class="m">4</span><span class="w">  </span><span class="m">0</span><span class="w">  </span><span class="m">0</span><span class="w">  </span><span class="m">0</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>run:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np 4 pw.x &lt; nscf.in |tee log_nscf.out
</pre></div>
</div>
</section>
<section id="band-structure">
<h3>Band structure<a class="headerlink" href="#band-structure" title="Link to this heading">#</a></h3>
<p>In order to gain a deeper understanding of the electronic states of the system, we proceed to compute the band structure along a path of high-symmetry points in the Brillouin Zone (BZ), specifically tracing the $W-L-\Gamma-X-W$ line.
We detailed our analysis, employing the <code class="docutils literal notranslate"><span class="pre">projwfc.x</span></code> utility to compute wavefunctions projected onto atomic orbitals. This allows us to examine the band structure with an emphasis on orbital contributions, providing a more detailed view of the electronic states and their interactions with the atomic structure of the material.</p>
<div style="text-align: center;">
    <img src="https://hackmd.io/_uploads/r1EIqE-xC.png" alt="bz-path" width=40% pos=center>
</div> 
1. Create and move to a new `bands` folder
2. Copy the `scf` `.save` folder in the current directory `$ cp -r ../scf/LiF.save .`
3. create a new input file `nscf.in` (in QE a `bands` and `nscf` calculation are equivalent)
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">&amp;</span><span class="n">control</span>
    <span class="n">calculation</span> <span class="o">=</span> <span class="s1">&#39;nscf&#39;</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span>
    <span class="n">pseudo_dir</span>   <span class="o">=</span> <span class="s2">&quot;../psps&quot;</span>
    <span class="n">outdir</span>       <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">wf_collect</span><span class="o">=.</span><span class="n">TRUE</span><span class="o">.</span><span class="p">,</span>
    <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;LiF&#39;</span><span class="p">,</span>
 <span class="o">/</span>
 <span class="o">&amp;</span><span class="n">system</span>
    <span class="n">ibrav</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nat</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ntyp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">force_symmorphic</span><span class="o">=.</span><span class="n">TRUE</span><span class="o">.</span> <span class="p">,</span>
    <span class="n">ecutwfc</span> <span class="o">=</span> <span class="mf">80.0</span><span class="p">,</span>
    <span class="n">nbnd</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">,</span>
    <span class="n">celldm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">7.703476</span><span class="p">,</span>
 <span class="o">/</span>
 <span class="o">&amp;</span><span class="n">electrons</span>
    <span class="n">diago_full_acc</span> <span class="o">=</span> <span class="o">.</span><span class="n">TRUE</span><span class="o">.</span><span class="p">,</span>
    <span class="n">conv_thr</span> <span class="o">=</span>  <span class="mf">1.0</span><span class="n">d</span><span class="o">-</span><span class="mi">10</span>
 <span class="o">/</span>
 <span class="n">ATOMIC_SPECIES</span>
    <span class="n">Li</span>    <span class="mf">6.941</span>       <span class="n">Li</span><span class="o">.</span><span class="n">LDA</span><span class="o">.</span><span class="n">cpi</span><span class="o">.</span><span class="n">UPF</span>
     <span class="n">F</span>    <span class="mf">18.998403</span>   <span class="n">F</span><span class="o">.</span><span class="n">LDA</span><span class="o">.</span><span class="n">cpi</span><span class="o">.</span><span class="n">UPF</span>
 <span class="n">ATOMIC_POSITIONS</span> <span class="n">crystal</span>
<span class="n">Li</span>  <span class="mf">0.</span> <span class="mf">0.</span> <span class="mf">0.</span>
 <span class="n">F</span>  <span class="mf">0.5</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">-</span><span class="mf">0.5</span>
<span class="n">K_POINTS</span> <span class="n">crystal_b</span>
<span class="mi">121</span>
<span class="mf">0.5</span>    <span class="mf">0.25</span>    <span class="mf">0.75</span>    <span class="mi">1</span>
<span class="mf">0.5</span>    <span class="mf">0.25833333333333336</span>    <span class="mf">0.7416666666666667</span>    <span class="mi">1</span>
<span class="o">...</span>
<span class="mf">0.5</span>    <span class="mf">0.25</span>    <span class="mf">0.75</span>    <span class="mi">1</span>
</pre></div>
</div>
<p>Note that we created a list of k-points along the high-symmetry path using <strong>yambopy</strong>. After importing the correct libraries you can create an instance of the <code class="docutils literal notranslate"><span class="pre">Path</span></code> class along the given path with <code class="docutils literal notranslate"><span class="pre">npoints</span></code> between each high-symmetry point.</p>
<div class="highlight-python= notranslate"><div class="highlight"><pre><span></span># Define path in reduced coordinates using Class Path
npoints = 30
path_kpoints = Path([[[  0.5,  0.250,  0.750],&#39;W&#39;],
                     [[0.5,0.5,  0.5],&#39;L&#39;],  
              [[  0.0,  0.0,  0.0],&#39;$\Gamma$&#39;],
              [[  0.5,  0.0,  0.5],&#39;X&#39;],
              [[  0.5,  0.250,  0.750],&#39;W&#39;]],[npoints,npoints,npoints,npoints] )
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>run:
<code class="docutils literal notranslate"> <span class="pre">$</span> <span class="pre">mpirun</span> <span class="pre">-np</span> <span class="pre">4</span> <span class="pre">pw.x</span> <span class="pre">&lt;</span> <span class="pre">nscf.in</span> <span class="pre">|tee</span> <span class="pre">log_nscf.out</span></code></p></li>
<li><p>Compute the orbital
wavefunction. Create a new <code class="docutils literal notranslate"><span class="pre">bands.in</span></code> file</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="p">&amp;</span>projwfc
<span class="w">    </span><span class="nv">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LiF&#39;</span>,
<span class="w">    </span><span class="nv">outdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;./&#39;</span>,
<span class="w">    </span><span class="nv">ngauss</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">degauss</span><span class="o">=</span><span class="m">0</span>.036748
<span class="w">    </span><span class="nv">kresolveddos</span><span class="o">=</span>.true.<span class="w"> </span>!<span class="w"> </span>optional
<span class="w">    </span><span class="nv">DeltaE</span><span class="o">=</span><span class="m">0</span>.01
<span class="w">    </span><span class="nv">filpdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LiF-pdos.dat&#39;</span>
<span class="w"> </span>/
</pre></div>
</div>
<p>an run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np 4 projwfc.x &lt; bands.in |tee projwfc.log
</pre></div>
</div>
<p><strong>Note</strong> the output file has to be named <code class="docutils literal notranslate"><span class="pre">projwfc.log</span></code> for yambopy</p>
<ol class="arabic simple" start="4">
<li><p>Inspect the output file <code class="docutils literal notranslate"><span class="pre">projwfc.log</span></code> to get the indices of the state belonging to a given atom’s orbital</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="n">Atomic</span> <span class="n">states</span> <span class="n">used</span> <span class="k">for</span> <span class="n">projection</span>
     <span class="p">(</span><span class="n">read</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pseudopotential</span> <span class="n">files</span><span class="p">):</span>

     <span class="n">state</span> <span class="c1">#   1: atom   1 (Li ), wfc  1 (l=0 m= 1)</span>
     <span class="n">state</span> <span class="c1">#   2: atom   1 (Li ), wfc  2 (l=1 m= 1)</span>
<span class="o">...</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Plot the orbital projected band structure via <code class="docutils literal notranslate"><span class="pre">yambopy</span></code>:</p></li>
</ol>
<div class="highlight-python= notranslate"><div class="highlight"><pre><span></span># import libraries
from yambopy import *
import matplotlib.pyplot as plt
from yambopy.lattice import car_red, red_car
import matplotlib.pylab as pylab
from matplotlib.ticker import MultipleLocator
import matplotlib.lines as mlines

# create a figure and ax
fig,ax = plt.subplots(dpi=300)

dotsize = 10 #size of the dots, change at will
# Read the indices from `projwfc.log`. Remember python counting starts from 0

atom_Li_s = [0]
atom_Li_p = [1,2,3]
atom_Li_d = [4,5,6,7,8]
atom_Li_f = [9,10,11,12,13,14,15,15]
atom_F_s = [16]
atom_F_p = [17,18,19]
atom_F_d = [20,21,22,23,24,25,26]
atom_F_f = [27,28,29,30,31]
# get ticks and labels, need previous istance of Path
ticks, labels =list(zip(*path_kpoints.get_indexes()))

# create an instance of ProjwfcXML class
band = ProjwfcXML(prefix=&#39;LiF&#39;,path=f&#39;./bands/&#39;,qe_version=&#39;6.7&#39;)
nelectrons = 8
Li_s = band.plot_eigen(ax,path_kpoints=path_kpoints,selected_orbitals=atom_Li_s,color=&#39;pink&#39;,size=dotsize)
Li_p = band.plot_eigen(ax,path_kpoints=path_kpoints,selected_orbitals=atom_Li_p,color=&#39;yellow&#39;,size=dotsize)
Li_d = band.plot_eigen(ax,path_kpoints=path_kpoints,selected_orbitals=atom_Li_d,color=&#39;orange&#39;,size=dotsize)
Li_f = band.plot_eigen(ax,path_kpoints=path_kpoints,selected_orbitals=atom_Li_f,color=&#39;red&#39;,size=dotsize)
F_s = band.plot_eigen(ax,path_kpoints=path_kpoints,selected_orbitals=atom_F_s,color=&#39;blue&#39;,size=dotsize)
F_p = band.plot_eigen(ax,path_kpoints=path_kpoints,selected_orbitals=atom_F_p,color=&#39;indigo&#39;,size=dotsize)
F_d = band.plot_eigen(ax,path_kpoints=path_kpoints,selected_orbitals=atom_F_d,color=&#39;cyan&#39;,size=dotsize)
F_f = band.plot_eigen(ax,path_kpoints=path_kpoints,selected_orbitals=atom_F_f,color=&#39;green&#39;,size=dotsize)

# setting labels and legend of the plot
Li_s.set_label(r&#39;$Li_s$&#39;)
Li_p.set_label(r&quot;$Li_p$&quot;)
Li_d.set_label(r&#39;$Li_d$&#39;)
Li_f.set_label(r&quot;$Li_f$&quot;)
F_s.set_label(r&#39;$F_s$&#39;)
F_p.set_label(r&#39;$F_p$&#39;)
F_d.set_label(r&#39;$F_d$&#39;)
F_f.set_label(r&#39;$F_f$&#39;)
ax.set_ylabel(&#39;E [eV]&#39;)
#ax.set_ylim([-5,20])
lgnd = plt.legend(loc=(1.04, 0), scatterpoints=1, markerscale=20, fontsize=15)
lgnd.legendHandles[0]._sizes = [dotsize]
lgnd.legendHandles[1]._sizes = [dotsize]
lgnd.legendHandles[2]._sizes = [dotsize]
lgnd.legendHandles[3]._sizes = [dotsize]
lgnd.legendHandles[4]._sizes = [dotsize]
lgnd.legendHandles[5]._sizes = [dotsize]
lgnd.legendHandles[6]._sizes = [dotsize]
lgnd.legendHandles[7]._sizes = [dotsize]
#save figure
plt.savefig(f&#39;./bands/full_orbbands.pdf&#39;,bbox_inches=&#39;tight&#39;)
</pre></div>
</div>
<p>You can play with the aesthetic and plotting options. The final result should look like this</p>
<img src="https://hackmd.io/_uploads/HJA3REbeR.png" alt="full_orbbands" style="width: 48%; margin-right: 2%;">
<img src="https://hackmd.io/_uploads/ry-8Jr-lA.png" alt="orbbands" style="width: 48%;">
<p>Examining the two figures reveals that the top three valence bands predominantly consist of Fluorine p orbitals, whereas the initial conduction band exhibits a composition of mixed orbitals, including $Li_p$, $Li_s$, $F_s$, and $F_p$. This detail is crucial for the Wannierization process and presents a slight deviation from the analysis conducted in reference <a class="footnote-reference brackets" href="#id16" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>, which focused solely on $Li_s$ and $F_p$ orbitals.</p>
</section>
<section id="wannierization">
<h3>Wannierization<a class="headerlink" href="#wannierization" title="Link to this heading">#</a></h3>
<p><strong>Requirement</strong>: Navigate to the <code class="docutils literal notranslate"><span class="pre">.save</span></code> directory within the [nscf](#non-self-consistent calculation) section and initialize the Yambo database using the <code class="docutils literal notranslate"><span class="pre">p2y</span></code> and <code class="docutils literal notranslate"><span class="pre">yambo</span></code> commands.</p>
<p>Before the Wannier90 analysis, it’s necessary to perform an [nscf](#non-self-consistent calculation) employing a uniform k-grid. We will explore calculations using two different grids: a k-grid of 8x8x8 and a q-grid of 4x4x4, focusing our discussion on the q-grid.</p>
<ol class="arabic simple">
<li><p>To create a uniform k-grid, you could use the kmesh.pl utility available in the <code class="docutils literal notranslate"><span class="pre">wannier90</span></code> package. Yet, to maintain consistency in the k-grid utilized by both Yambo and QE, we opt for yambopy to generate a comprehensive list of k-points across the full Brillouin Zone (BZ).</p></li>
</ol>
<div class="highlight-python= notranslate"><div class="highlight"><pre><span></span># 
savedb_q = YamboSaveDB.from_db_file(f&#39;{YAMBO_TUT_PATH}/unshifted-grid/SAVE&#39;)
lat_q = YamboLatticeDB.from_db_file(f&#39;{YAMBO_TUT_PATH}/unshifted-grid/SAVE/ns.db1&#39;)
full_kpoints, kpoints_indexes, symmetry_indexes=savedb_q.expand_kpts()
full_kpoints_red = car_red(full_kpoints, lat_q.rlat)

# Generate list of q-points with weights

for i in range (len(full_kpoints_red)):
    print(f&#39;{full_kpoints_red[i][0]:.10f}   {full_kpoints_red[i][1]:.10f}   {full_kpoints_red[i][2]:.10f} {1/len(full_kpoints_red):.10f}&#39;)
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Create an <code class="docutils literal notranslate"><span class="pre">nscf.in</span></code> input file</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">&amp;</span><span class="n">control</span>
    <span class="n">calculation</span> <span class="o">=</span> <span class="s1">&#39;nscf&#39;</span><span class="p">,</span>
    <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;high&#39;</span>
    <span class="n">pseudo_dir</span>   <span class="o">=</span> <span class="s2">&quot;../psps&quot;</span>
    <span class="n">outdir</span>       <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">wf_collect</span><span class="o">=.</span><span class="n">TRUE</span><span class="o">.</span><span class="p">,</span>
    <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;LiF&#39;</span><span class="p">,</span>
 <span class="o">/</span>
 <span class="o">&amp;</span><span class="n">system</span>
    <span class="n">ibrav</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nat</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ntyp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">force_symmorphic</span><span class="o">=.</span><span class="n">TRUE</span><span class="o">.</span> <span class="p">,</span>
    <span class="n">ecutwfc</span> <span class="o">=</span> <span class="mf">80.0</span><span class="p">,</span>
    <span class="n">nbnd</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">,</span>
    <span class="n">celldm</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="mf">7.703476</span><span class="p">,</span>
 <span class="o">/</span>
 <span class="o">&amp;</span><span class="n">electrons</span>
    <span class="n">diago_full_acc</span> <span class="o">=</span> <span class="o">.</span><span class="n">TRUE</span><span class="o">.</span><span class="p">,</span>
    <span class="n">conv_thr</span> <span class="o">=</span>  <span class="mf">1.0</span><span class="n">d</span><span class="o">-</span><span class="mi">10</span>
 <span class="o">/</span>
 <span class="n">ATOMIC_SPECIES</span>
    <span class="n">Li</span>    <span class="mf">6.941</span>       <span class="n">Li</span><span class="o">.</span><span class="n">LDA</span><span class="o">.</span><span class="n">cpi</span><span class="o">.</span><span class="n">UPF</span>
     <span class="n">F</span>    <span class="mf">18.998403</span>   <span class="n">F</span><span class="o">.</span><span class="n">LDA</span><span class="o">.</span><span class="n">cpi</span><span class="o">.</span><span class="n">UPF</span>
 <span class="n">ATOMIC_POSITIONS</span> <span class="n">crystal</span>
<span class="n">Li</span>  <span class="mf">0.</span> <span class="mf">0.</span> <span class="mf">0.</span>
 <span class="n">F</span>  <span class="mf">0.5</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">-</span><span class="mf">0.5</span>
<span class="n">K_POINTS</span> <span class="n">crystal</span>
<span class="mi">64</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.00000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.25000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.50000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.00000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.25000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.50000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.00000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.25000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.50000000</span>  <span class="mf">1.562500e-02</span>
  <span class="mf">0.75000000</span>  <span class="mf">0.75000000</span>  <span class="mf">0.75000000</span>  <span class="mf">1.562500e-02</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Create an input file for wannier90 <code class="docutils literal notranslate"><span class="pre">LiF.win</span></code>:</p></li>
</ol>
<div class="highlight-bash= notranslate"><div class="highlight"><pre><span></span>num_bands         =   10
num_wann          =   8


DIS_WIN_MIN = -25
DIS_WIN_MAX = 24
dis_num_iter      = 1000
dis_mix_ratio     = 0.4

num_iter          = 3000
iprint    = 3
!num_dump_cycles = 10
!num_print_cycles = 1000


bands_num_points = 201
bands_plot_format = gnuplot

write_rmn = true
write_tb  = true
write_xyz = .true.
wannier_plot_supercell = 3
use_ws_distance = .true.
translate_home_cell = .true.

bands_plot = true
write_hr = true
Fermi_energy = 3.63060
Begin Atoms_Frac
F            0.5000000000       -0.5000000000      -0.5000000000
Li           0.0000000000       0.0000000000       0.0000000000
End Atoms_Frac

Begin Projections
Li :l=0;l=1
F : l=0;l=1
End Projections

Begin kpoint_path
W  0.500    0.250    0.750 L  0.500    0.500    0.500
L  0.500    0.500    0.500 Γ  0.000    0.000    0.00
Γ  0.000    0.000    0.00 X  0.500    0.000    0.500
X  0.500    0.000    0.500 W  0.500    0.250    0.750
End kpoint_path

Begin Unit_Cell_Cart
Bohr
     -3.851738  0.0000000000      3.851738
     0.000000000000000   3.851738 3.851738
     -3.851738  3.851738 0.000000000000000
End Unit_Cell_Cart

mp_grid      = 4 4 4

!exclude_bands 1,6,7,8,9,10
Begin kpoints
  0.00000000  0.00000000  0.00000000  1.562500e-02
  0.00000000  0.00000000  0.25000000  1.562500e-02
  0.00000000  0.00000000  0.50000000  1.562500e-02
  0.00000000  0.00000000  0.75000000  1.562500e-02
  0.00000000  0.25000000  0.00000000  1.562500e-02
  0.00000000  0.25000000  0.25000000  1.562500e-02
  0.00000000  0.25000000  0.50000000  1.562500e-02
  0.00000000  0.25000000  0.75000000  1.562500e-02
  0.00000000  0.50000000  0.00000000  1.562500e-02
  0.00000000  0.50000000  0.25000000  1.562500e-02
  0.00000000  0.50000000  0.50000000  1.562500e-02
  0.00000000  0.50000000  0.75000000  1.562500e-02
  0.00000000  0.75000000  0.00000000  1.562500e-02
  0.00000000  0.75000000  0.25000000  1.562500e-02
  0.00000000  0.75000000  0.50000000  1.562500e-02
  0.00000000  0.75000000  0.75000000  1.562500e-02
  0.25000000  0.00000000  0.00000000  1.562500e-02
  0.25000000  0.00000000  0.25000000  1.562500e-02
  0.25000000  0.00000000  0.50000000  1.562500e-02
  0.25000000  0.00000000  0.75000000  1.562500e-02
  0.25000000  0.25000000  0.00000000  1.562500e-02
  0.25000000  0.25000000  0.25000000  1.562500e-02
  0.25000000  0.25000000  0.50000000  1.562500e-02
  0.25000000  0.25000000  0.75000000  1.562500e-02
  0.25000000  0.50000000  0.00000000  1.562500e-02
  0.25000000  0.50000000  0.25000000  1.562500e-02
  0.25000000  0.50000000  0.50000000  1.562500e-02
  0.25000000  0.50000000  0.75000000  1.562500e-02
  0.25000000  0.75000000  0.00000000  1.562500e-02
  0.25000000  0.75000000  0.25000000  1.562500e-02
  0.25000000  0.75000000  0.50000000  1.562500e-02
  0.25000000  0.75000000  0.75000000  1.562500e-02
  0.50000000  0.00000000  0.00000000  1.562500e-02
  0.50000000  0.00000000  0.25000000  1.562500e-02
  0.50000000  0.00000000  0.50000000  1.562500e-02
  0.50000000  0.00000000  0.75000000  1.562500e-02
  0.50000000  0.25000000  0.00000000  1.562500e-02
  0.50000000  0.25000000  0.25000000  1.562500e-02
  0.50000000  0.25000000  0.50000000  1.562500e-02
  0.50000000  0.25000000  0.75000000  1.562500e-02
  0.50000000  0.50000000  0.00000000  1.562500e-02
  0.50000000  0.50000000  0.25000000  1.562500e-02
  0.50000000  0.50000000  0.50000000  1.562500e-02
  0.50000000  0.50000000  0.75000000  1.562500e-02
  0.50000000  0.75000000  0.00000000  1.562500e-02
  0.50000000  0.75000000  0.25000000  1.562500e-02
  0.50000000  0.75000000  0.50000000  1.562500e-02
  0.50000000  0.75000000  0.75000000  1.562500e-02
  0.75000000  0.00000000  0.00000000  1.562500e-02
  0.75000000  0.00000000  0.25000000  1.562500e-02
  0.75000000  0.00000000  0.50000000  1.562500e-02
  0.75000000  0.00000000  0.75000000  1.562500e-02
  0.75000000  0.25000000  0.00000000  1.562500e-02
  0.75000000  0.25000000  0.25000000  1.562500e-02
  0.75000000  0.25000000  0.50000000  1.562500e-02
  0.75000000  0.25000000  0.75000000  1.562500e-02
  0.75000000  0.50000000  0.00000000  1.562500e-02
  0.75000000  0.50000000  0.25000000  1.562500e-02
  0.75000000  0.50000000  0.50000000  1.562500e-02
  0.75000000  0.50000000  0.75000000  1.562500e-02
  0.75000000  0.75000000  0.00000000  1.562500e-02
  0.75000000  0.75000000  0.25000000  1.562500e-02
  0.75000000  0.75000000  0.50000000  1.562500e-02
  0.75000000  0.75000000  0.75000000  1.562500e-02
end kpoints
</pre></div>
</div>
<p>For the initial projections see the discussion in <a class="reference internal" href="#Band-structure"><span class="xref myst">Band structure</span></a></p>
<ol class="arabic simple" start="3">
<li><p>Copy the <code class="docutils literal notranslate"><span class="pre">scf</span></code> <code class="docutils literal notranslate"><span class="pre">.save</span></code> folder <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">cp</span> <span class="pre">-r</span> <span class="pre">../scf/LiF.save</span> <span class="pre">.</span></code> (for the k-grid you might want to run another scf run with an 8x8x8 grid to ensure consistency)</p></li>
<li><p>Run an <code class="docutils literal notranslate"><span class="pre">nscf</span></code> calculation</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np 4 pw.x &lt; nscf.in |tee log_nscf.out
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Run the pre-processing steps of Wannier90</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np 1 wannier90.x -pp LiF
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>Create an input file <code class="docutils literal notranslate"><span class="pre">pw2wan.in</span></code> for <code class="docutils literal notranslate"><span class="pre">pw2wannier90.x</span></code> and run <code class="docutils literal notranslate"><span class="pre">pw2wannier90.x</span></code>:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="p">&amp;</span>inputpp
<span class="nv">outdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;./&#39;</span>
<span class="nv">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LiF&#39;</span>
<span class="nv">seedname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LiF&#39;</span>
<span class="nv">write_amn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.true.
<span class="nv">write_mmn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.true.
<span class="nv">write_unk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.true.<span class="w"> </span>!optional
/
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np 1 pw2wannier90.x &lt; pw2wan.in |tee log_pw2wan.out
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>Finally run <code class="docutils literal notranslate"><span class="pre">wannier90.x</span></code></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np 1 wannier90.x LiF
</pre></div>
</div>
<p>You should now have a <code class="docutils literal notranslate"><span class="pre">seedname_hr.dat</span></code> file containing the real-space Hamiltonian in the MLWF basis.
We can compare the electronic band structure obtained with <code class="docutils literal notranslate"><span class="pre">Wannier90</span></code> and <code class="docutils literal notranslate"><span class="pre">QE</span></code> via the following Python scripting.</p>
<div class="highlight-python= notranslate"><div class="highlight"><pre><span></span>import tbmodels
from yambopy import *
import matplotlib.pyplot as plt
from yambopy.lattice import car_red, red_car
import matplotlib.pylab as pylab
from pylab import rcParams
from matplotlib.ticker import MultipleLocator
import matplotlib.lines as mlines

WORK_PATH=&#39;./&#39;
unshifted_gridpath=&#39;yambo_tutorials/unshifted-grid/&#39;
# Read xml file from a bands calculation
xml = ProjwfcXML(prefix=&#39;LiF&#39;,path=f&#39;{unshiftedgrid_path}/bands/&#39;,qe_version=&#39;6.7&#39;)

# Compare DFT vs Wannier band structure
from qepy.lattice import Path, calculate_distances 
# Class PwXML. QE database reading
xml = ProjwfcXML(prefix=&#39;LiF&#39;,path=f&#39;{unshiftedgrid_path}/bands/&#39;,qe_version=&#39;6.7&#39;)
wann_bands = np.loadtxt(f&#39;{unshiftedgrid_path}/nscf-wannier-qgrid/LiF_band.dat&#39;,usecols=(0,1))
# Class PwXML. QE database reading
fig, ax = plt.subplots()
kpoints_dists = calculate_distances(xml.kpoints[:xml.nkpoints])
#xml.plot_eigen_ax(ax, path_kpoints, y_offset=-1., lw =1, ylim=(-4,17))
for ib in range(xml.nbands):
  ax.plot(kpoints_dists, xml.eigen[:,ib], c=&#39;red&#39;,lw=1.0)
ax.scatter(wann_bands[:,0]/np.max(wann_bands[:,0])*np.max(kpoints_dists), wann_bands[:,1], c=&#39;black&#39;,s=0.5)
# tb_eb = tb_ebands.add_kpath_labels(ax)
legend_entries = [
    mlines.Line2D([], [], color=&#39;black&#39;, ls =&#39;-&#39;, label=&#39;Wannier&#39;),
    mlines.Line2D([], [], color=&#39;red&#39;, label=&#39;DFT&#39;),
]

# # Add custom legend outside the loop
ax.legend(handles=legend_entries, loc=&#39;upper center&#39;, bbox_to_anchor=(0.5, 1.20), ncol=3)
# ax.plot(qe_en, qe_bands)
ax.set_ylabel(&#39;E [eV]&#39;)
ax.set_ylim(-5,26)
#plt.show()
plt.savefig(f&#39;{unshiftedgrid_path}/bands/DFTvsWann_q.pdf&#39;,bbox_inches=&#39;tight&#39;)

</pre></div>
</div>
<p>We can now compare the results obtained Wannierizing the k- and q-grid with the DFT computed band structure.</p>
<img src="https://hackmd.io/_uploads/BJlrTvZxC.png" alt="dftvswann_k" style="width: 48%; margin-right: 2%;">
<img src="https://hackmd.io/_uploads/ryiSaw-x0.png" alt="dftvswann_q" style="width: 48%;">
<p>The two plots are reasonable in agreement but not ideal. We recover the degeneracy at W in the valence bands manifold.
It is possible to increase the accurarcy of Wannier interpolation increasing the size of the grid.
Notably, if I were to include only $Li_s$ and $F_p$ orbitals as in ref<a class="footnote-reference brackets" href="#id16" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> is difficult to achieve a reasonable band structure and it might be necesssary to increase the <code class="docutils literal notranslate"><span class="pre">num_iter=1000000</span></code>. From the orbital projected band structure it’s evident that these orbitals are not enough to describe the first conduction band and upmost three valence band.</p>
</section>
</section>
</section>
<section id="excited-state-yambo">
<h1>Excited state - YAMBO<a class="headerlink" href="#excited-state-yambo" title="Link to this heading">#</a></h1>
<p><strong>Requirements</strong>: Run the DFT <a class="reference internal" href="#DFT"><span class="xref myst">scf and nscf</span></a> calculations. You can download all input and references file <a class="reference external" href="https://media.yambo-code.eu/educational/tutorials/files/LiF.tar.gz">here</a></p>
<p>Now, we transition to examining the excited state properties calculated via the ab initio Many-Body Perturbation Theory (Ai-MBPT) approach, facilitated by the Yambo code. Contrary to the approach detailed <a class="reference internal" href="#DFT"><span class="xref myst">previously</span></a>, here we employ shifted k-grids, as demonstrated below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">K_POINTS</span> <span class="n">automatic</span>
 <span class="mi">4</span>  <span class="mi">4</span>  <span class="mi">4</span>  <span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">1</span>
</pre></div>
</div>
<p>This phase involves a comparative analysis between results derived from <em>shifted</em> and <em>unshifted</em> grids. Assuming the <a class="reference internal" href="#DFT"><span class="xref myst">preceding steps</span></a> were executed without issues, you should now possess a <code class="docutils literal notranslate"><span class="pre">LiF.save</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls LiF.save
charge-density.dat  data-file-schema.xml  F.LDA.cpi.UPF  Li.LDA.cpi.UPF  wfc10.dat  wfc1.dat  wfc2.dat	wfc3.dat  wfc4.dat  wfc5.dat  wfc6.dat	wfc7.dat 
</pre></div>
</div>
<section id="conversion-to-yambo-format">
<h2>Conversion to Yambo format<a class="headerlink" href="#conversion-to-yambo-format" title="Link to this heading">#</a></h2>
<p>The PWscf <code class="docutils literal notranslate"><span class="pre">LiF.save</span></code> output is converted to the Yambo format using the <code class="docutils literal notranslate"><span class="pre">p2y</span></code> executable, found in the yambo <code class="docutils literal notranslate"><span class="pre">bin</span></code> directory. Enter <code class="docutils literal notranslate"><span class="pre">LiF.save</span></code> and launch <code class="docutils literal notranslate"><span class="pre">p2y</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd LiF.save
$ p2y
...
 &lt;---&gt;  XC potential           : Slater exchange(X)+Perdew &amp; Zunger(C)
 &lt;---&gt;  Atomic species        :  2
 &lt;---&gt;  Max atoms/species     :  1
 &lt;---&gt; == DB1 (Gvecs and more) ...
 &lt;---&gt; ... Database done
 &lt;---&gt; == DB2 (wavefunctions)  ...
 &lt;---&gt; [p2y] WF I/O |                                        | [000%] --(E) --(X)
 &lt;---&gt; [p2y] WF I/O |########################################| [100%] --(E) --(X)
 &lt;---&gt; == DB3 (PseudoPotential) ...
 &lt;---&gt;  == P2Y completed ==
</pre></div>
</div>
<p>This output repeats some information about the system and generates a <code class="docutils literal notranslate"><span class="pre">SAVE</span></code> directory that contains among others the <code class="docutils literal notranslate"><span class="pre">ns.db1</span></code> database with information about the crystal structure of the system.</p>
</section>
<section id="initialization">
<h2>Initialization<a class="headerlink" href="#initialization" title="Link to this heading">#</a></h2>
<p>The initialization procedure is common to all yambo runs.</p>
<ol class="arabic simple">
<li><p>Enter the <code class="docutils literal notranslate"><span class="pre">YAMBO</span></code> directory (where you have previously created the <code class="docutils literal notranslate"><span class="pre">SAVE</span></code> folder) and type</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>yambo<span class="w"> </span>-F<span class="w"> </span>Inputs/01_init<span class="w"> </span>-J<span class="w"> </span>01_init
</pre></div>
</div>
<p>and you will see:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">&lt;---&gt;</span> <span class="p">[</span><span class="mf">03.01</span><span class="p">]</span> <span class="n">X</span> <span class="n">indexes</span>
 <span class="o">&lt;---&gt;</span> <span class="n">X</span> <span class="p">[</span><span class="nb">eval</span><span class="p">]</span> <span class="o">|</span>                                        <span class="o">|</span> <span class="p">[</span><span class="mi">000</span><span class="o">%</span><span class="p">]</span> <span class="o">--</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">--</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
 <span class="o">&lt;---&gt;</span> <span class="n">X</span> <span class="p">[</span><span class="nb">eval</span><span class="p">]</span> <span class="o">|</span><span class="c1">########################################| [100%] --(E) --(X)</span>
 <span class="o">&lt;---&gt;</span> <span class="n">X</span><span class="p">[</span><span class="n">REDUX</span><span class="p">]</span> <span class="o">|</span>                                        <span class="o">|</span> <span class="p">[</span><span class="mi">000</span><span class="o">%</span><span class="p">]</span> <span class="o">--</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">--</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
 <span class="o">&lt;---&gt;</span> <span class="n">X</span><span class="p">[</span><span class="n">REDUX</span><span class="p">]</span> <span class="o">|</span><span class="c1">########################################| [100%] --(E) --(X)</span>
 <span class="o">&lt;---&gt;</span> <span class="p">[</span><span class="mf">03.01.01</span><span class="p">]</span> <span class="n">Sigma</span> <span class="n">indexes</span>
 <span class="o">&lt;---&gt;</span> <span class="n">Sigma</span> <span class="p">[</span><span class="nb">eval</span><span class="p">]</span> <span class="o">|</span>                                        <span class="o">|</span> <span class="p">[</span><span class="mi">000</span><span class="o">%</span><span class="p">]</span> <span class="o">--</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">--</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
 <span class="o">&lt;---&gt;</span> <span class="n">Sigma</span> <span class="p">[</span><span class="nb">eval</span><span class="p">]</span> <span class="o">|</span><span class="c1">########################################| [100%] --(E) --(X)</span>
 <span class="o">&lt;---&gt;</span> <span class="n">Sigma</span><span class="p">[</span><span class="n">REDUX</span><span class="p">]</span> <span class="o">|</span>                                        <span class="o">|</span> <span class="p">[</span><span class="mi">000</span><span class="o">%</span><span class="p">]</span> <span class="o">--</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">--</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
 <span class="o">&lt;---&gt;</span> <span class="n">Sigma</span><span class="p">[</span><span class="n">REDUX</span><span class="p">]</span> <span class="o">|</span><span class="c1">########################################| [100%] --(E) --(X)</span>
 <span class="o">&lt;---&gt;</span> <span class="p">[</span><span class="mi">04</span><span class="p">]</span> <span class="n">Timing</span> <span class="n">Overview</span>
 <span class="o">&lt;---&gt;</span> <span class="p">[</span><span class="mi">05</span><span class="p">]</span> <span class="n">Memory</span> <span class="n">Overview</span>
 <span class="o">&lt;---&gt;</span> <span class="p">[</span><span class="mi">06</span><span class="p">]</span> <span class="n">Game</span> <span class="n">Over</span> <span class="o">&amp;</span> <span class="n">Game</span> <span class="n">summary</span>
</pre></div>
</div>
<p>this run produced an <code class="docutils literal notranslate"><span class="pre">r_setup</span></code> file with a lot of useful information about your system, like the Fermi level, the crystal structure, the number of k-points, the gap etc…</p>
</section>
<section id="random-phase-approximation">
<h2>Random-Phase approximation<a class="headerlink" href="#random-phase-approximation" title="Link to this heading">#</a></h2>
<p>In this section, we calculate the absorption spectrum of LiF under various levels of approximation for the kernel. The most fundamental approach to estimating LiF’s absorption spectrum is the independent particle approximation (<code class="docutils literal notranslate"><span class="pre">02_RPA_no_LF</span></code>). Following this, we introduce a kernel based on the Hartree approximation (<code class="docutils literal notranslate"><span class="pre">03_RPA_LF</span></code>), aligning with the Random-Phase-Approximation (RPA) framework. Moreover, to closely align with experimental absorption peak data, we employ a rigid scissor shift of the electronic states(<code class="docutils literal notranslate"><span class="pre">03_RPA_LF_QP</span></code>)</p>
<ol class="arabic simple">
<li><p>Create an input file called <code class="docutils literal notranslate"><span class="pre">02_RPA_no_LF</span></code></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">optics</span>                       <span class="c1"># [R OPT] Optics</span>
<span class="n">chi</span>                          <span class="c1"># [R LR] Linear Response.</span>
<span class="o">%</span> <span class="n">QpntsRXd</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">|</span>                   <span class="c1"># [Xd] Transferred momenta</span>
<span class="o">%</span>
<span class="o">%</span> <span class="n">BndsRnXd</span>
   <span class="mi">1</span> <span class="o">|</span>  <span class="mi">10</span> <span class="o">|</span>                 <span class="c1"># [Xd] Polarization function bands</span>
<span class="o">%</span>
<span class="n">NGsBlkXd</span><span class="o">=</span> <span class="mi">1</span>              <span class="n">RL</span>  <span class="c1"># [Xd] Response block size</span>
<span class="o">%</span> <span class="n">EnRngeXd</span>
  <span class="mf">7.50000</span> <span class="o">|</span> <span class="mf">25.00000</span> <span class="o">|</span>   <span class="n">eV</span>  <span class="c1"># [Xd] Energy range</span>
<span class="o">%</span>
<span class="o">%</span> <span class="n">DmRngeXd</span>
  <span class="mf">0.10000</span> <span class="o">|</span>  <span class="mf">0.30000</span> <span class="o">|</span>   <span class="n">eV</span>  <span class="c1"># [Xd] Damping range</span>
<span class="o">%</span>
<span class="n">ETStpsXd</span><span class="o">=</span> <span class="mi">300</span>                <span class="c1"># [Xd] Total Energy steps</span>
<span class="o">%</span> <span class="n">LongDrXd</span>
 <span class="mf">1.000000</span> <span class="o">|</span> <span class="mf">0.000000</span> <span class="o">|</span> <span class="mf">0.000000</span> <span class="o">|</span>      <span class="c1"># [Xd] [cc] Electric Field</span>
<span class="o">%</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Run yambo:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ yambo -F 02_RPA_no_LF -J 02_RPA_no_LF
</pre></div>
</div>
<p>The optional <em>-J</em> flag is used to label the output/report/log files.</p>
<ol class="arabic simple" start="3">
<li><p>Create the input files <code class="docutils literal notranslate"><span class="pre">03_RPA_LF</span></code> and <code class="docutils literal notranslate"><span class="pre">03_RPA_LF_QP</span></code>:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">optics</span>                       <span class="c1"># [R OPT] Optics</span>
<span class="n">chi</span>                          <span class="c1"># [R LR] Linear Response.</span>
<span class="o">%</span> <span class="n">QpntsRXd</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span> <span class="o">|</span>                   <span class="c1"># [Xd] Transferred momenta</span>
<span class="o">%</span>
<span class="o">%</span> <span class="n">BndsRnXd</span>
   <span class="mi">1</span> <span class="o">|</span>  <span class="mi">10</span> <span class="o">|</span>                 <span class="c1"># [Xd] Polarization function bands</span>
<span class="o">%</span>
<span class="n">NGsBlkXd</span><span class="o">=</span><span class="mi">51</span>              <span class="n">RL</span>  <span class="c1"># [Xd] Response block size</span>
<span class="o">%</span> <span class="n">EnRngeXd</span>
  <span class="mf">7.50000</span> <span class="o">|</span> <span class="mf">25.00000</span> <span class="o">|</span>   <span class="n">eV</span>  <span class="c1"># [Xd] Energy range</span>
<span class="o">%</span>
<span class="o">%</span> <span class="n">DmRngeXd</span>
  <span class="mf">0.10000</span> <span class="o">|</span>  <span class="mf">0.30000</span> <span class="o">|</span>   <span class="n">eV</span>  <span class="c1"># [Xd] Damping range</span>
<span class="o">%</span>
<span class="n">ETStpsXd</span><span class="o">=</span> <span class="mi">300</span>                <span class="c1"># [Xd] Total Energy steps</span>
<span class="o">%</span> <span class="n">LongDrXd</span>
 <span class="mf">1.000000</span> <span class="o">|</span> <span class="mf">0.000000</span> <span class="o">|</span> <span class="mf">0.000000</span> <span class="o">|</span>      <span class="c1"># [Xd] [cc] Electric Field</span>
<span class="o">%</span>
</pre></div>
</div>
<span style="color: red;">
% XfnQP_E 
<p>5.190000 | 1.000000 | 1.000000 |      # [EXTQP Xd] E parameters (c/v), scissor</p>
</span> 
<p>and run yambo</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ yambo -F 03_RPA_LF -J -03_RPA_LF
$ yambo -F 03_RPA_LF -J -03_RPA_LF_QP
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Plot the output data via</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># read files</span>
<span class="n">data_02_RPA_no_LF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">YAMBO_TUT_PATH</span><span class="si">}</span><span class="s1">/shifted-grid/o-02_RPA_no_LF.eps_q1_inv_rpa_dyson&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">data_03_RPA_LF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">YAMBO_TUT_PATH</span><span class="si">}</span><span class="s1">/shifted-grid/o-03_RPA_LF.eps_q1_inv_rpa_dyson&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">data_03_RPA_LF_QP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">YAMBO_TUT_PATH</span><span class="si">}</span><span class="s1">/shifted-grid/o-03_RPA_LF_QP.eps_q1_inv_rpa_dyson&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">data_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">YAMBO_TUT_PATH</span><span class="si">}</span><span class="s1">/e2_experimental.dat&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="c1">#plot</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_02_RPA_no_LF</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">data_02_RPA_no_LF</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;02_RPA_no_LF&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_03_RPA_LF</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">data_03_RPA_LF</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;03_RPA_LF&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_03_RPA_LF_QP</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">data_03_RPA_LF_QP</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;03_RPA_LF_QP&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_exp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">data_exp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experiment&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Absorption [a.u.]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Energy [eV]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">YAMBO_TUT_PATH</span><span class="si">}</span><span class="s1">/shifted-grid/absorption_tut_v1.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="absorption_tut_v1" src="https://hackmd.io/_uploads/SJnNyFZl0.png" /></p>
<p>As we can see, the energy shifting helps with matching the experimental energy onset but there is an experimental peak below the fundamental peak which is not captured by our current level of approximation. This state is an <strong>EXCITON</strong>.</p>
</section>
<section id="adiabatic-lda-alda-approximation">
<h2>Adiabatic LDA (ALDA) approximation<a class="headerlink" href="#adiabatic-lda-alda-approximation" title="Link to this heading">#</a></h2>
<p>Our first attempt to go beyond RPA is using TDDFT in the Adiabatic LDA approximation. Depending on the exchange-correlation (xc) functional used in the ground state calculation yambo will produce a corresponding xc-kernel. In this case, we are using a Perdew Wang parametrization.
Create a <code class="docutils literal notranslate"><span class="pre">04_alda_g_space</span></code> file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>optics<span class="w">                       </span><span class="c1"># [R OPT] Optics</span>
chi<span class="w">                          </span><span class="c1"># [R LR] Linear Response.</span>
alda_fxc<span class="w">                     </span><span class="c1"># [R TDDFT] The ALDA TDDFT kernel</span>
%<span class="w"> </span>QpntsRXd
<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w">                     </span><span class="c1"># [Xd] Transferred momenta</span>
%
%<span class="w"> </span>BndsRnXd
<span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="p">|</span><span class="w">                   </span><span class="c1"># [Xd] Polarization function bands</span>
%
<span class="nv">NGsBlkXd</span><span class="o">=</span><span class="w">  </span><span class="m">51</span><span class="w">            </span>RL<span class="w">  </span><span class="c1"># [Xd] Response block size</span>
%<span class="w"> </span>EnRngeXd
<span class="w">  </span><span class="m">7</span>.50000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">25</span>.00000<span class="w"> </span><span class="p">|</span><span class="w">   </span>eV<span class="w">  </span><span class="c1"># [Xd] Energy range</span>
%
%<span class="w"> </span>DmRngeXd
<span class="w"> </span><span class="m">0</span>.100000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.300000<span class="w"> </span><span class="p">|</span><span class="w">   </span>eV<span class="w">  </span><span class="c1"># [Xd] Damping range</span>
%
<span class="nv">ETStpsXd</span><span class="o">=</span><span class="w"> </span><span class="m">300</span><span class="w">                </span><span class="c1"># [Xd] Total Energy steps</span>
%<span class="w"> </span>LongDrXd
<span class="w"> </span><span class="m">1</span>.000000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.000000<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.000000<span class="w"> </span><span class="p">|</span><span class="w">      </span><span class="c1"># [Xd] [cc] Electric Field</span>
%
<span class="nv">FxcGRLc</span><span class="o">=</span><span class="w"> </span><span class="m">51</span><span class="w">              </span>RL<span class="w">  </span><span class="c1"># [TDDFT] XC-kernel RL size</span>
</pre></div>
</div>
<p>and run <code class="docutils literal notranslate"><span class="pre">yambo</span></code> again</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ yambo -F 04_alda_g_space -J 04_alda_g_space
</pre></div>
</div>
<p>If we plot again, the result does not improve considerably.</p>
<p><img alt="absorption_tut_v2" src="https://hackmd.io/_uploads/S1ZlGYWgA.png" /></p>
</section>
<section id="the-statically-screened-electron-electron-interaction">
<h2>The Statically screened Electron-electron interaction<a class="headerlink" href="#the-statically-screened-electron-electron-interaction" title="Link to this heading">#</a></h2>
<p>As simple LDA and ALDA approximations have not described correctly the experimental spectrum we have tom ove towads more elaborate techniques like the Bethe-Salpeter equation (BSE).
A key ingredient in the BSE kernel is the <em>electron-electron interaction</em> commonly evaluated in the static approximation. The input file <code class="docutils literal notranslate"><span class="pre">05_W</span></code> describes how to calculate it</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">em1s</span>                         <span class="c1"># [R Xs] Static Inverse Dielectric Matrix</span>
<span class="o">%</span> <span class="n">QpntsRXs</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="mi">19</span> <span class="o">|</span>                   <span class="c1"># [Xs] Transferred momenta</span>
<span class="o">%</span>
<span class="o">%</span> <span class="n">BndsRnXs</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="mi">50</span> <span class="o">|</span>                   <span class="c1"># [Xs] Polarization function bands</span>
<span class="o">%</span>
<span class="n">NGsBlkXs</span><span class="o">=</span><span class="mi">51</span>              <span class="n">RL</span>  <span class="c1"># [Xs] Response block size</span>
<span class="o">%</span> <span class="n">LongDrXs</span>
 <span class="mf">1.000000</span> <span class="o">|</span> <span class="mf">0.000000</span> <span class="o">|</span> <span class="mf">0.000000</span> <span class="o">|</span>      <span class="c1"># [Xs] [cc] Electric Field</span>
<span class="o">%</span>
</pre></div>
</div>
<p>The variables used in htis input file have the same physical meaning of those used in the optical absorption calculation. The only difference is that, in general, the response function dimension obtained in the examples (03-04), gives an upper bound to the number of RL vectors needed here. This is because the size of response matrix in an RPA calculation defines also the size of the Hartree potential, whose short-range components are not screened. In the present case, instead, the electron-electron interaction is screened and, for this reason, the RL vectors are considerably smaller than in the RPA case.
Run this calculation via</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ yambo -F 05_W
</pre></div>
</div>
<p>to create the <code class="docutils literal notranslate"><span class="pre">ndb.em1s</span></code> database which will be read in the BSE calculation.</p>
</section>
<section id="the-bse-equation-excitons">
<h2>The BSE equation, Excitons<a class="headerlink" href="#the-bse-equation-excitons" title="Link to this heading">#</a></h2>
<p>In this subsection, we calculate the excitonic absorption spectrum, solving the BSE equation.</p>
<ol class="arabic simple">
<li><p>Create an input file <code class="docutils literal notranslate"><span class="pre">06_BSE</span></code></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">optics</span>                       <span class="c1"># [R OPT] Optics</span>
<span class="n">bse</span>                          <span class="c1"># [R BSK] Bethe Salpeter Equation.</span>
<span class="n">bss</span>                          <span class="c1"># [R BSS] Bethe Salpeter Equation solver</span>
<span class="o">%</span> <span class="n">KfnQP_E</span>
 <span class="mf">5.80000</span> <span class="o">|</span> <span class="mf">1.000000</span> <span class="o">|</span> <span class="mf">1.000000</span> <span class="o">|</span>      <span class="c1"># [EXTQP BSK BSS] E parameters (c/v), scissor</span>
<span class="o">%</span>
<span class="n">BSKmod</span><span class="o">=</span> <span class="s2">&quot;SEX&quot;</span>              <span class="c1"># [BSK] Resonant Kernel mode. (`x`;`c`;`d`)</span>
<span class="o">%</span> <span class="n">BSEBands</span>
  <span class="mi">2</span> <span class="o">|</span>  <span class="mi">7</span> <span class="o">|</span>                   <span class="c1"># [BSK] Bands range</span>
<span class="o">%</span>
<span class="n">BSENGBlk</span><span class="o">=</span>  <span class="mi">51</span>            <span class="n">RL</span>  <span class="c1"># [BSK] Screened interaction block size</span>
<span class="n">BSENGexx</span><span class="o">=</span>  <span class="mi">773</span>           <span class="n">RL</span>  <span class="c1"># [BSK] Exchange components</span>
<span class="n">BSSmod</span><span class="o">=</span> <span class="s2">&quot;d&quot;</span>                  <span class="c1"># [BSS] Solvers `h/d/i/t`</span>
<span class="o">%</span> <span class="n">BEnRange</span>
  <span class="mf">7.50000</span> <span class="o">|</span> <span class="mf">25.00000</span> <span class="o">|</span>   <span class="n">eV</span>  <span class="c1"># [BSS] Energy range</span>
<span class="o">%</span>
<span class="o">%</span> <span class="n">BDmRange</span>
  <span class="mf">0.15000</span> <span class="o">|</span>  <span class="mf">0.30000</span> <span class="o">|</span>   <span class="n">eV</span>  <span class="c1"># [BSS] Damping range</span>
<span class="o">%</span>
<span class="n">BEnSteps</span><span class="o">=</span> <span class="mi">300</span>                <span class="c1"># [BSS] Energy steps</span>
<span class="o">%</span> <span class="n">BLongDir</span>
 <span class="mf">1.000000</span> <span class="o">|</span> <span class="mf">0.000000</span> <span class="o">|</span> <span class="mf">0.000000</span> <span class="o">|</span>      <span class="c1"># [BSS] [cc] Electric Field</span>
<span class="o">%</span>
<span class="o">%</span> <span class="n">BSEQptR</span>
 <span class="mi">1</span> <span class="o">|</span> <span class="mi">19</span> <span class="o">|</span>                             <span class="c1"># [BSK] Transferred momenta range</span>
<span class="o">%</span>
</pre></div>
</div>
<p>Note that we are applying a 5.8 eV scissor and including both exchange and correlations terms in the kernel via the screened exchange (SEX) approximation for the kernel (<code class="docutils literal notranslate"><span class="pre">BSKmod=&quot;SEX&quot;</span></code>)
Remember that the BSE kernel is written in Bloch space and its size is given by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BSE</span> <span class="n">kernel</span> <span class="n">size</span> <span class="o">=</span> <span class="n">Valence</span> <span class="n">Bands</span> <span class="n">x</span> <span class="n">Conduction</span> <span class="n">bands</span> <span class="n">x</span> <span class="n">K</span><span class="o">-</span><span class="n">points</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">whole</span> <span class="n">BZ</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Run yambo:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ yambo -F 06_BSE -J 06_BSE
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Plot the output files and compare the results.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">data_06_BSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">YAMBO_TUT_PATH</span><span class="si">}</span><span class="s1">/shifted-grid/o-06_BSE.eps_q1_diago_bse&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="o">...</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_06_BSE</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">data_06_BSE</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;06_BSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="absorption_tut_v3" src="https://hackmd.io/_uploads/r1f3rFbgC.png" /></p>
<p>We see that we have much better agreement with experiment and the BSE equation is able to describe the bound electron-hole state responsible for the peak observed experimentally below the QP gap.</p>
</section>
<section id="shifted-vs-unshifted-grid">
<h2>shifted vs unshifted grid<a class="headerlink" href="#shifted-vs-unshifted-grid" title="Link to this heading">#</a></h2>
<p>We can now repeat the same steps starting from an unshifted grid (<code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">4</span> <span class="pre">4</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span></code>).
Note that in the unshifted case you have 64 k-points in the BZ, while in the shifted case you have 4 shifts for a total of 64*4=256 points in the BZ.
<img alt="absorptionshitvsunshift" src="https://hackmd.io/_uploads/BydV9YWeR.png" /></p>
<p>The two results differ only slightly.</p>
<p><strong>Notes for developers:</strong></p>
<ol class="arabic simple">
<li><p>Question: In the <code class="docutils literal notranslate"><span class="pre">r_setup</span></code> files I can see that the K-grid has 10 IBZ points and 256 full BZ while the Q-grid has 19 IBZ and 256 points. Why this difference?</p></li>
</ol>
</section>
</section>
<section id="exciton-band-structure">
<h1>Exciton band structure<a class="headerlink" href="#exciton-band-structure" title="Link to this heading">#</a></h1>
<p>In this section, we will try to reproduce the exciton band structure from <em>Neaton et al.</em> <a class="footnote-reference brackets" href="#id16" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p>
<p><a id="excbandsref"></a></p>
<figure>
    <img src="https://hackmd.io/_uploads/r1zOnKWxA.png" alt="Alt text for the image" style="width:60%">
    <figcaption>Singlet (left panel) and triplet (right panel) exciton dispersion for LiF. Linear interpolation of exciton eigenergeies explicitly explicitly obtained by diagonalizing the BSE at 72 Q points along the high-symmetry path (blue curve). Wannier-Fourier interpolated exciton dispersion starting from a centered 5 × 5 × 5 Q mesh (dotted red curve). The inset of the left panel shows how Wannier-Fourier interpolation performs without isolating the long-range contribution.
    </figcaption>
</figure>
<p>We will work with the 2 <em>unshifted-grids</em> a (<code class="docutils literal notranslate"><span class="pre">4</span> <span class="pre">4</span> <span class="pre">4</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span></code>) and an (<code class="docutils literal notranslate"><span class="pre">8</span> <span class="pre">8</span> <span class="pre">8</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span></code>).
After solving the BSE equation for all 19 q-points in the BZ you will have a list of files <code class="docutils literal notranslate"><span class="pre">ndb.BS_diag_Q*</span></code> containing the eigenvalues and eigenvectors for each q-transferred momenta.
In order to plot the exciton band structure:</p>
<ol class="arabic simple">
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">ypp</span></code> input file <code class="docutils literal notranslate"><span class="pre">ypp-excbands.in</span></code> for interpolation:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">excitons</span>                         <span class="c1"># [R] Excitonic properties</span>
<span class="n">interpolate</span>                      <span class="c1"># [R] Interpolate</span>
<span class="n">INTERP_mode</span><span class="o">=</span> <span class="s2">&quot;BOLTZ&quot;</span>                <span class="c1"># Interpolation mode (NN=nearest point, BOLTZ=boltztrap aproach)</span>
<span class="n">INTERP_Shell_Fac</span><span class="o">=</span> <span class="mf">20.00000</span>       <span class="c1"># The bigger it is a higher number of shells is used</span>
<span class="n">INTERP_NofNN</span><span class="o">=</span> <span class="mi">1</span>                  <span class="c1"># Number of Nearest sites in the NN method</span>
<span class="n">BANDS_steps</span><span class="o">=</span> <span class="mi">30</span>                  <span class="c1"># Number of divisions</span>
<span class="n">cooIn</span><span class="o">=</span> <span class="s2">&quot;rlu&quot;</span>                     <span class="c1"># Points coordinates (in) cc/rlu/iku/alat</span>
<span class="n">cooOut</span><span class="o">=</span> <span class="s2">&quot;rlu&quot;</span>                    <span class="c1"># Points coordinates (out) cc/rlu/iku/alat</span>
<span class="n">States</span><span class="o">=</span> <span class="s2">&quot;1 - 4&quot;</span>                  <span class="c1"># Index of the BS state(s)</span>
<span class="o">%</span> <span class="n">INTERP_Grid</span>
<span class="o">-</span><span class="mi">1</span> <span class="o">|-</span><span class="mi">1</span> <span class="o">|-</span><span class="mi">1</span> <span class="o">|</span>                             <span class="c1"># Interpolation BZ Grid</span>
<span class="o">%</span>
<span class="c1">#PrtDOS                        # Print Exciton Density of States</span>
<span class="o">%</span> <span class="n">DOSERange</span>
 <span class="mf">1.000000</span> <span class="o">|-</span><span class="mf">1.000000</span> <span class="o">|</span>         <span class="n">eV</span>    <span class="c1"># Energy range</span>
<span class="o">%</span>
<span class="n">DOSESteps</span><span class="o">=</span>  <span class="mi">500</span>                  <span class="c1"># Energy steps</span>
<span class="n">DOS_broad</span><span class="o">=</span> <span class="mf">0.100000</span>        <span class="n">eV</span>    <span class="c1"># Broadening of the DOS</span>
<span class="o">%</span><span class="n">BANDS_kpts</span>                      <span class="c1"># K points of the bands circuit</span>
<span class="mf">0.5</span><span class="o">|</span><span class="mf">0.5</span><span class="o">|</span><span class="mf">0.5</span><span class="o">|</span>
<span class="mf">0.0</span><span class="o">|</span><span class="mf">0.0</span><span class="o">|</span><span class="mf">0.0</span><span class="o">|</span>
<span class="mf">0.5</span><span class="o">|</span><span class="mf">0.0</span><span class="o">|</span><span class="mf">0.5</span><span class="o">|</span>
<span class="mf">0.5</span><span class="o">|</span><span class="mf">0.250</span><span class="o">|</span><span class="mf">0.750</span><span class="o">|</span>
<span class="mf">0.5</span><span class="o">|</span><span class="mf">0.50</span><span class="o">|</span><span class="mf">0.50</span><span class="o">|</span>
<span class="o">%</span>
</pre></div>
</div>
<p>Note that, in my experience the <code class="docutils literal notranslate"><span class="pre">NN</span></code> interpolation mode does not work.
2. Run <code class="docutils literal notranslate"><span class="pre">ypp</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="mi">4</span> <span class="n">ypp</span> <span class="o">-</span><span class="n">F</span> <span class="n">ypp</span><span class="o">-</span><span class="n">excbands</span><span class="o">.</span><span class="ow">in</span> <span class="o">-</span><span class="n">J</span> <span class="s1">&#39;bse-bands&#39;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Plot the exciton band structure from the <code class="docutils literal notranslate"><span class="pre">o-bse-bands.excitons_interpolated</span></code> output file</p></li>
</ol>
<div class="highlight-python= notranslate"><div class="highlight"><pre><span></span>...
#data_excbands_shifted = np.loadtxt(f&#39;{YAMBO_TUT_PATH}/shifted-grid/bse-bands/o-bse-bands.excitons_interpolated&#39;, usecols=(0,1,2,3,4,5,6))
data_excbands_unshifted = np.loadtxt(f&#39;{YAMBO_TUT_PATH}/unshifted-grid/bse-bands/o-bse-bands.excitons_interpolated&#39;, usecols=(0,1,2,3,4,5,6))
fig,ax =plt.subplots()
#ax.plot(data_excbands_shifted[:,0], data_excbands_shifted[:,1], label=&#39;06_BSE_shifted&#39;, c=&#39;blue&#39;)
ax.plot(data_excbands_unshifted[:,0], data_excbands_unshifted[:,1], label=&#39;06_BSE_unshifted&#39;,c=&#39;orange&#39;)
#ax.plot(data_excbands_shifted[:,0], data_excbands_shifted[:,2], c =&#39;blue&#39;)
ax.plot(data_excbands_unshifted[:,0], data_excbands_unshifted[:,2], c=&#39;orange&#39;)
#ax.plot(data_excbands_shifted[:,0], data_excbands_shifted[:,3], c =&#39;blue&#39;)
ax.plot(data_excbands_unshifted[:,0], data_excbands_unshifted[:,3], c=&#39;orange&#39;)
#ax.plot(data_excbands_shifted[:,0], data_excbands_shifted[:,4], c =&#39;blue&#39;)
ax.plot(data_excbands_unshifted[:,0], data_excbands_unshifted[:,4], c=&#39;orange&#39;)
#ax.plot(data_excbands_shifted[:,0], data_excbands_shifted[:,5], c =&#39;blue&#39;)
ax.plot(data_excbands_unshifted[:,0], data_excbands_unshifted[:,5], c=&#39;orange&#39;)
#ax.plot(data_excbands_shifted[:,0], data_excbands_shifted[:,6], c =&#39;blue&#39;)
ax.plot(data_excbands_unshifted[:,0], data_excbands_unshifted[:,6], c=&#39;orange&#39;)
ticks, labels =list(zip(*path_kpoints.get_indexes()))
kpoints_dists= np.array(kpoints_dists)
ax.set_xticks(kpoints_dists[np.array(ticks)]/np.max(kpoints_dists[np.array(ticks)])*np.max(data_excbands_unshifted[:,0]), labels)
ax.set_ylabel(&#39;Energy [eV]&#39;)
ax.set_xlabel(&#39;$q_x$&#39;)
ax.legend(loc=&#39;upper left&#39;, fontsize=8)
plt.savefig(f&#39;{YAMBO_TUT_PATH}/excbands_unshifted.pdf&#39;, bbox_inches=&#39;tight&#39;)
</pre></div>
</div>
<figure>
    <img src="https://hackmd.io/_uploads/rJ_gY_feC.png" alt="Alt text for the image" style="width:100%">
    <figcaption>Exciton band structure computed starting with a k-grid = 4 4 4 0 0 0.
    </figcaption>
</figure>
<p>If we compare this plot with the one above from Haber et al<a class="footnote-reference brackets" href="#id16" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> we see that the result do not match. Notably, the degeneracy at W is not recovered.
We can try to increase the <code class="docutils literal notranslate"><span class="pre">k-grid</span> <span class="pre">=</span> <span class="pre">8</span> <span class="pre">8</span> <span class="pre">8</span> <span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span></code> and plot the result as above</p>
<figure>
    <img src="https://hackmd.io/_uploads/rybqcdMxC.png" alt="Alt text for the image" style="width:100%">
    <figcaption>Exciton band structure computed starting with a k-grid = 8 8 8 0 0 0.
    </figcaption>
</figure>
<p>The result change noticeably and the degeneracy at W is almost recovered.
These discrepancies might be due to underconverged parameters in the BSE calculation.
We can compare the results obtained with shifted and unshifted grid</p>
<figure>
    <img src="https://hackmd.io/_uploads/SyzkTOGeC.png" alt="Alt text for the image" style="width:100%">
    <figcaption>Exciton band structure computed starting with a k-grid = 8 8 8 0 0 0 (orange) and k-grid = 4 4 4 1 1 1 (blue).
    </figcaption>
</figure>
<p><strong>Note for developers:</strong></p>
<ol class="arabic simple">
<li><p><strong>Error:</strong> the distances computed with <code class="docutils literal notranslate"><span class="pre">yambopy</span></code> and <code class="docutils literal notranslate"><span class="pre">ypp</span></code> differs. As you note in line 19 of the script above I had to rescale the <code class="docutils literal notranslate"><span class="pre">$q_x$</span></code> distances.</p></li>
<li><p><strong>Error:</strong> Even though I asked in the <code class="docutils literal notranslate"><span class="pre">ypp</span></code> input for <code class="docutils literal notranslate"><span class="pre">BANDS_steps=30</span></code> I end up with 93 q-points instead of 121.</p></li>
</ol>
<section id="exciton-band-structure-singlets-vs-triplets">
<h2>Exciton band structure: singlets vs triplets<a class="headerlink" href="#exciton-band-structure-singlets-vs-triplets" title="Link to this heading">#</a></h2>
<p>Yambo, by defaults, cmomputes singlets. In order to plot triplets we can set to “0 RL” the cutoff of the ex exchange in the BSE kernel.</p>
<ol class="arabic simple">
<li><p>Change the <span style="color: red;"> BSENGexx=  0 RL</span> input flag in the <code class="docutils literal notranslate"><span class="pre">06_BSE</span></code> input file and run again the BSE calculation</p></li>
<li><p>Compute the exciton band structure with <code class="docutils literal notranslate"><span class="pre">ypp</span></code> as above</p></li>
<li><p>Plot the exciton band structure, comparing singlets vs triplets results.</p></li>
</ol>
<figure>
    <img src="https://hackmd.io/_uploads/r1TBaFGeR.png" alt="Alt text for the image" style="width:100%">
    <figcaption>Exciton band structure for singlets (blue) and triplets(orange) components. The plots were generated computed starting with a k-grid = 4 4 4 1 1 1 (orange) and k-grid = 4 4 4 1 1 1 (blue).
    </figcaption>
</figure>
<p>Note that now we recover the degenercy at $W$ and the result is not so different from the <a class="reference internal" href="#excbandsref"><span class="xref myst">reference</span></a>. There is still some discrepancy on the first two bands between $L$ and $\Gamma$ that should be degenerate.</p>
</section>
</section>
<section id="useful-link">
<h1>Useful Link<a class="headerlink" href="#useful-link" title="Link to this heading">#</a></h1>
<ol class="arabic simple">
<li><p>Download input files QE + Yambo <a class="reference external" href="https://media.yambo-code.eu/educational/tutorials/files/LiF.tar.gz">here</a>:</p></li>
<li><p>Access additional input files for Wannierization and Python notebook from branch <code class="docutils literal notranslate"><span class="pre">devel</span> <span class="pre">tb-wannier</span></code> of <a class="reference external" href="https://github.com/rreho/yambopy/tree/master">this repo</a></p></li>
</ol>
</section>
<section id="tb-wannier">
<h1>TB-wannier<a class="headerlink" href="#tb-wannier" title="Link to this heading">#</a></h1>
<figure>
    <img src="https://hackmd.io/_uploads/rkbDh9zlA.png" alt="Alt text for the image" style="width:100%">
    <figcaption> Utilities implemented in yambopy for exciton Wannierization.
    </figcaption>
</figure>
</section>
<section id="bibliography">
<h1>Bibliography<a class="headerlink" href="#bibliography" title="Link to this heading">#</a></h1>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id11" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Kohn, W. (2019). Density functional theory. Introductory quantum mechanics with MATLAB: for atoms, molecules, clusters, and nanocrystals.</p>
</aside>
<aside class="footnote brackets" id="id12" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">6</a><span class="fn-bracket">]</span></span>
<p>Giannozzi, P., Baseggio, O., Bonfà, P., Brunato, D., Car, R., Carnimeo, I., … &amp; Baroni, S. (2020). Quantum ESPRESSO toward the exascale. The Journal of chemical physics, 152(15).</p>
</aside>
<aside class="footnote brackets" id="id13" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">2</a><span class="fn-bracket">]</span></span>
<p>Marzari, N., Mostofi, A. A., Yates, J. R., Souza, I., &amp; Vanderbilt, D. (2012). Maximally localized Wannier functions: Theory and applications. Reviews of Modern Physics, 84(4), 1419.</p>
</aside>
<aside class="footnote brackets" id="id14" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>Sangalli, D., Ferretti, A., Miranda, H., Attaccalite, C., Marri, I., Cannuccia, E., … &amp; Marini, A. (2019). Many-body perturbation theory calculations using the yambo code. Journal of Physics: Condensed Matter, 31(32), 325902.</p>
</aside>
<aside class="footnote brackets" id="id15" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>Marini, A., Hogan, C., Grüning, M., &amp; Varsano, D. (2009). Yambo: an ab initio tool for excited state calculations. Computer Physics Communications, 180(8), 1392-1403.</p>
</aside>
<aside class="footnote brackets" id="id16" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id6">1</a>,<a role="doc-backlink" href="#id7">2</a>,<a role="doc-backlink" href="#id8">3</a>,<a role="doc-backlink" href="#id9">4</a>,<a role="doc-backlink" href="#id10">5</a>)</span>
<p>Haber, J. B., Qiu, D. Y., da Jornada, F. H., &amp; Neaton, J. B. (2023). Maximally localized exciton Wannier functions for solids. Physical Review B, 108(12), 125118</p>
</aside>
</aside>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content/tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">LiF tutorial - From ground state DFT to excited state MBPT via Wannerization methods</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-analysis-with-yambo">Advanced analysis with Yambo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tools-and-libraries">Tools and libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computational-details">Computational details</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#crystal-structure-lif">Crystal structure LiF</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dft">DFT</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#self-consistent-field-calculation">self-consistent field calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-self-consistent-calculation">non-self-consistent calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#band-structure">Band structure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wannierization">Wannierization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#excited-state-yambo">Excited state - YAMBO</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conversion-to-yambo-format">Conversion to Yambo format</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initialization">Initialization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-phase-approximation">Random-Phase approximation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adiabatic-lda-alda-approximation">Adiabatic LDA (ALDA) approximation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-statically-screened-electron-electron-interaction">The Statically screened Electron-electron interaction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-bse-equation-excitons">The BSE equation, Excitons</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shifted-vs-unshifted-grid">shifted vs unshifted grid</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exciton-band-structure">Exciton band structure</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exciton-band-structure-singlets-vs-triplets">Exciton band structure: singlets vs triplets</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#useful-link">Useful Link</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#tb-wannier">TB-wannier</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#bibliography">Bibliography</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Riccardo Reho
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>